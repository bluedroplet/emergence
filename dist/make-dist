#!/bin/bash

cd ../em-tools
make distclean
aclocal-1.8 || exit
automake-1.8 || exit
autoconf-2.58 || exit


./configure || exit

make distcheck || exit
                                                                                                                               
cp em-tools-0.5.0.tar.bz2 ../dist

cd ../dist
                                                                                                                               


rm -rf root
mkdir -p root/usr

cd ../em-game
make distclean
aclocal-1.8 || exit
automake-1.8 || exit
autoconf-2.58 || exit

./configure CFLAGS="-march=pentium3 -O2 -pipe -fomit-frame-pointer -fprefetch-loop-arrays" --prefix=`pwd`/../dist/root/usr || exit
make || exit
make install || exit

cd ../dist/root

strip usr/bin/* || exit
tar --owner=0 --group=0 --numeric-owner -cjf ../em-game-0.5.0-bin.tar.bz2 * || exit
cd ..


cd ../em-tools

./configure CFLAGS="-march=pentium3 -O2 -pipe -fomit-frame-pointer -fprefetch-loop-arrays" --prefix=`pwd`/../dist/root/usr || exit
make || exit
make install || exit

cd ../dist/root

strip usr/bin/* || exit

tar --owner=0 --group=0 --numeric-owner -cjf ../emergence-0.5.0-bin.tar.bz2 * || exit
cd ..


#rpmbuild -bb emergence-0.4.spec

#cp /home/jonny/redhat/emergence/i386/emergence-0.4-1.i386.rpm .
